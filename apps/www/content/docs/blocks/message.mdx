---
title: Message
description: Message component for displaying AI and user messages in chat interfaces
author: AF
---

<ComponentPreview name="message-demo" description="Message component with AIMessage and UserMessage" className="mb-4" />

Message 组件提供了用于显示 AI 消息和用户消息的完整样式组件，支持消息状态管理、反馈区域、附件展示等功能，适用于聊天界面、对话系统、AI 助手等场景。

## Overview

- **两种消息类型**：AIMessage（AI 消息）和 UserMessage（用户消息），样式自动区分
- **状态管理**：AI 消息支持 idle、generating、failed 三种状态
- **内容渲染**：根据状态智能渲染内容，生成中显示 loading，失败显示错误信息
- **反馈区域**：内置反馈插槽，方便添加点赞、复制等操作
- **样式隔离**：消息样式不受文档框架影响，保持一致性
- **无障碍访问**：支持 ARIA live regions，屏幕阅读器友好

## Quick Start

```tsx
import { AIMessage, UserMessage } from "@/registry/wuhan/composed/message";

export function Example() {
  return (
    <div className="space-y-4">
      <UserMessage>
        请帮我解释一下 React Hooks 的工作原理
      </UserMessage>
      
      <AIMessage 
        status="idle"
        content="React Hooks 是 React 16.8 引入的新特性..."
      />
    </div>
  );
}
```

## Features

- **AI 消息状态**：idle（正常）、generating（生成中）、failed（失败）三种状态
- **智能内容渲染**：根据状态自动渲染 content 或 children
- **用户消息**：简洁的用户消息样式，带背景色区分
- **反馈支持**：通过 feedback 属性添加操作按钮
- **附件支持**：可在消息上方展示附件（图片、文件等）
- **错误处理**：失败状态自动显示错误信息

## Installation

<CodeTabs>

<TabsList>
  <TabsTrigger value="cli">CLI</TabsTrigger>
  <TabsTrigger value="manual">Manual</TabsTrigger>
</TabsList>

<TabsContent value="cli">

```bash
npx shadcn@latest add http://localhost:3000/r/wuhan/message.json
```

</TabsContent>

<TabsContent value="manual">

<Steps>

<Step>复制以下代码到你的项目</Step>

<ComponentSource name="message" title="registry/wuhan/composed/message/message.tsx" />

<Step>更新导入路径以匹配你的项目设置</Step>

</Steps>

</TabsContent>

</CodeTabs>

## Examples

### Default

基础的消息展示，包含用户消息和 AI 消息。

<ComponentPreview
  name="message-default"
  description="Basic message example"
  className="mb-4"
/>

### With Status

展示 AI 消息的不同状态，包括生成中状态和生成失败状态。

<ComponentPreview
  name="message-with-status"
  description="Message with status (generating, failed)"
  className="mb-4"
/>

### With Feedback

带反馈区域的消息，可以在消息下方添加操作按钮。

<ComponentPreview
  name="message-with-feedback"
  description="Message with feedback area"
  className="mb-4"
/>

### With Attachment

展示带附件的消息，附件显示在消息上方。

<ComponentPreview
  name="message-with-attachment"
  description="Message with attachment"
  className="mb-4"
/>

## API Reference

### AIMessage

AI 消息组件，支持状态管理和内容渲染。

#### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `status` | `"idle" \| "generating" \| "failed"` | - | AI 消息的生成状态（必填） |
| `content` | `ReactNode` | - | 消息内容，当 status 为 idle 时显示 |
| `children` | `ReactNode` | - | 替代 content 的内容，优先级更高 |
| `feedback` | `ReactNode` | - | 反馈区域内容（如点赞、复制按钮） |
| `className` | `string` | - | 额外的样式类名 |

#### Example

```tsx
import { AIMessage } from "@/registry/wuhan/composed/message";
import { ThumbsUp, ThumbsDown, Copy } from "lucide-react";

function ChatMessage() {
  const [status, setStatus] = React.useState<"idle" | "generating" | "failed">("generating");
  const [content, setContent] = React.useState("");
  
  return (
    <div className="space-y-4">
      {/* 生成中状态 */}
      <AIMessage status="generating" />
      
      {/* 正常状态，显示内容 */}
      <AIMessage 
        status="idle"
        content="这是 AI 的回复内容，支持 Markdown 格式..."
        feedback={
          <div className="flex gap-2 mt-2">
            <button className="p-1 hover:bg-muted rounded">
              <ThumbsUp className="w-4 h-4" />
            </button>
            <button className="p-1 hover:bg-muted rounded">
              <ThumbsDown className="w-4 h-4" />
            </button>
            <button className="p-1 hover:bg-muted rounded">
              <Copy className="w-4 h-4" />
            </button>
          </div>
        }
      />
      
      {/* 失败状态 */}
      <AIMessage status="failed" />
      
      {/* 使用 children 而非 content */}
      <AIMessage status="idle">
        <div className="prose">
          <h3>自定义内容</h3>
          <p>可以使用任意 React 组件作为内容</p>
        </div>
      </AIMessage>
    </div>
  );
}
```

### UserMessage

用户消息组件，简洁的样式设计。

#### Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `children` | `ReactNode` | - | 消息内容（必填） |
| `className` | `string` | - | 额外的样式类名 |

#### Example

```tsx
import { UserMessage } from "@/registry/wuhan/composed/message";

function UserChatMessage() {
  return (
    <div className="space-y-4">
      <UserMessage>
        这是用户发送的消息
      </UserMessage>
      
      <UserMessage className="max-w-md">
        用户消息支持自定义样式
      </UserMessage>
    </div>
  );
}
```

### AIMessageStatus

AI 消息状态类型定义。

```tsx
type AIMessageStatus = 
  | "idle"        // 正常状态，显示完整内容
  | "generating"  // 生成中，显示 loading 动画
  | "failed";     // 生成失败，显示错误提示
```

## 使用场景

- **AI 聊天应用**：ChatGPT、Claude 等 AI 对话界面
- **客服系统**：智能客服、在线咨询等场景
- **文档问答**：基于文档的问答系统
- **代码助手**：编程辅助、代码生成等工具
- **教学助手**：在线学习、答疑解惑等场景
- **协作工具**：团队沟通、任务分配等应用

## 最佳实践

1. **状态管理**：使用状态机管理消息的生成流程（generating → idle/failed）
2. **错误处理**：生成失败时提供重试按钮，提升用户体验
3. **内容格式**：AI 消息内容建议使用 Markdown 渲染，支持富文本
4. **反馈收集**：在 feedback 区域添加点赞、点踩，收集用户反馈
5. **流式渲染**：配合 SSE 或 WebSocket 实现流式内容更新
6. **无障碍性**：组件已内置 ARIA live regions，确保屏幕阅读器可访问

## 注意事项

- `children` 优先级高于 `content`，两者同时存在时使用 `children`
- `status="generating"` 时，`content` 和 `children` 会被忽略
- `status="failed"` 时，显示默认错误信息，可通过 `children` 自定义
- UserMessage 组件样式相对简单，主要用于区分用户和 AI 消息
- 建议为长消息添加滚动或折叠功能，避免页面过长

## 原语组件

Message 基于以下原语组件构建：

- `MessageAIPrimitive` - AI 消息容器原语
- `MessageUserPrimitive` - 用户消息容器原语

原语组件提供了基础的样式和结构，可以在 [registry/wuhan/blocks/message/message-01.tsx](../../registry/wuhan/blocks/message/message-01.tsx) 中找到。

## 样式定制

组件使用 Tailwind CSS，可以通过以下方式定制：

```tsx
// 自定义 AI 消息样式
<AIMessage 
  status="idle"
  content="内容"
  className="border-l-4 border-primary pl-4"
/>

// 自定义用户消息样式
<UserMessage className="bg-gradient-to-r from-blue-500 to-purple-500 text-white">
  自定义背景的用户消息
</UserMessage>
```

## 扩展示例

### 带头像的消息

```tsx
import { AIMessage, UserMessage } from "@/registry/wuhan/composed/message";
import { Avatar, AvatarImage, AvatarFallback } from "@/components/ui/avatar";

function MessageWithAvatar() {
  return (
    <div className="space-y-4">
      <div className="flex gap-3">
        <Avatar>
          <AvatarImage src="/user-avatar.png" />
          <AvatarFallback>U</AvatarFallback>
        </Avatar>
        <UserMessage>用户的消息</UserMessage>
      </div>
      
      <div className="flex gap-3">
        <Avatar>
          <AvatarImage src="/ai-avatar.png" />
          <AvatarFallback>AI</AvatarFallback>
        </Avatar>
        <AIMessage status="idle" content="AI 的回复" />
      </div>
    </div>
  );
}
```

### 流式消息渲染

```tsx
import { AIMessage } from "@/registry/wuhan/composed/message";
import { useState, useEffect } from "react";

function StreamingMessage() {
  const [content, setContent] = useState("");
  const [status, setStatus] = useState<"generating" | "idle">("generating");
  
  useEffect(() => {
    // 模拟流式响应
    const fullText = "这是一段流式生成的文本...";
    let index = 0;
    
    const interval = setInterval(() => {
      if (index < fullText.length) {
        setContent(fullText.slice(0, index + 1));
        index++;
      } else {
        setStatus("idle");
        clearInterval(interval);
      }
    }, 50);
    
    return () => clearInterval(interval);
  }, []);
  
  return (
    <AIMessage 
      status={status}
      content={content}
    />
  );
}
```

### 带代码高亮的消息

```tsx
import { AIMessage } from "@/registry/wuhan/composed/message";
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";

function MessageWithCode() {
  return (
    <AIMessage status="idle">
      <div className="space-y-2">
        <p>这是一个 React 组件示例：</p>
        <SyntaxHighlighter language="tsx">
          {`function Example() {
  return <div>Hello World</div>;
}`}
        </SyntaxHighlighter>
      </div>
    </AIMessage>
  );
}
```

### 可重试的错误消息

```tsx
import { AIMessage } from "@/registry/wuhan/composed/message";
import { RefreshCw } from "lucide-react";

function RetryableMessage() {
  const [status, setStatus] = useState<"failed" | "generating" | "idle">("failed");
  
  const handleRetry = () => {
    setStatus("generating");
    // 执行重试逻辑
    setTimeout(() => setStatus("idle"), 2000);
  };
  
  return (
    <AIMessage status={status} content={status === "idle" ? "成功生成的内容" : undefined}>
      {status === "failed" && (
        <div className="space-y-2">
          <p className="text-destructive">消息生成失败</p>
          <button 
            onClick={handleRetry}
            className="flex items-center gap-2 px-3 py-1.5 bg-primary text-primary-foreground rounded"
          >
            <RefreshCw className="w-4 h-4" />
            重试
          </button>
        </div>
      )}
    </AIMessage>
  );
}
```

### 消息列表

```tsx
import { AIMessage, UserMessage } from "@/registry/wuhan/composed/message";
import { ThumbsUp, Copy } from "lucide-react";

function MessageList() {
  const messages = [
    { role: "user", content: "什么是 React？" },
    { role: "ai", content: "React 是一个用于构建用户界面的 JavaScript 库..." },
    { role: "user", content: "它有什么优势？" },
    { role: "ai", content: "React 的主要优势包括组件化、虚拟 DOM、生态丰富等..." },
  ];
  
  return (
    <div className="space-y-4 max-w-3xl">
      {messages.map((msg, index) => (
        msg.role === "user" ? (
          <UserMessage key={index}>{msg.content}</UserMessage>
        ) : (
          <AIMessage 
            key={index}
            status="idle"
            content={msg.content}
            feedback={
              <div className="flex gap-2 mt-2">
                <button className="p-1 hover:bg-muted rounded">
                  <ThumbsUp className="w-4 h-4" />
                </button>
                <button className="p-1 hover:bg-muted rounded">
                  <Copy className="w-4 h-4" />
                </button>
              </div>
            }
          />
        )
      ))}
    </div>
  );
}
```
